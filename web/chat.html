<!DOCTYPE html>
<html lang="en">
  
	<head>
		<!-- Meta Stuff -->
		<meta charset="utf-8">
		<meta name="viewport" content="initial-scale=1, maximum-scale=1">
		<!-- Title -->
		<title>Freech</title>
		<!-- Fonts & Css -->
		<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
		<link href="./css/chat.css" rel="stylesheet" type="text/css">
	</head>
	
	<!-- The App -->
	<body>
		<!-- The Sidebar (displaying the logged-in users) -->
		<div class="sidebar">
			<!-- The Header -->
			<h1>People</h1>
			<!-- The list with all people -->
			<div class="scroll">
				<div v-for="user in freechTemp.userList" class="person {{ user.id | userclass }}">
					<span>{{ user.name }}</span>
				</div>
			</div>
			<!-- The share button -->
			<a href="javascript:void(0)" v-on:click="buttonToggleShare" class="share">Invite a friend</a>
			<!-- The Expiration Notice -->
			<span class="warning" v-if="freechTemp.expirationTimeLeft < 3600000">This chat will expire in {{ Math.floor(freechTemp.expirationTimeLeft / 60000) }} minutes.</span>
		</div>
		
		<!-- The Chat -->
		<div class="chat">
			<!-- Message Container -->
			<div id="chat-messages-scroll" v-on:scroll="scrollChat" class="messages">
				
				<!-- The loading indicator -->
				<span class="loading" v-show="freechTemp.loadingOldMessages" v-if="freechTemp.totalMessageCount !== freechTemp.messages.length && freechTemp.totalMessageCount !== -1">Loading ...</span>
				<!-- The no messages indicator -->
				<span class="loading" v-if="freechTemp.totalMessageCount === -1">No messages</span>
				
				<!-- A single message -->
				<div v-for="message in freechTemp.messages" class="message {{ message.userId | userclass }}">
					<span>{{ message.userId | username }} - {{ message.time | timestamp }}</span>
					<p v-if="message.text !== 'nogodsnomasters'">{{{ message.text | message }}}</p>
					<!-- Simple Easter Egg -->
					<img src="./images/no_gods-no_masters.png" v-if="message.text === 'nogodsnomasters'" style="width:350px;max-width:90%;height:auto;display:inline-block;border-radius:10px;">
				</div>
				
			</div>
			<!-- Send Input -->
			<div class="compose">
				<input type="text" v-model="input.newMessage" v-on:keyup.enter="buttonSendNewMessage" placeholder="What's on your mind?">
				<a href="javascript:void(0)" v-on:click="buttonSendNewMessage" class="send">Send</a>
			</div>
		</div>
		
		<!-- Share This Chat Modal -->
		<div class="modal" v-if="uiData.modals.share">
			<h1>Share this chat</h1>
			<p>To share this chat, please invite your friends using this URL.</p>
			<!-- URL -->
			<span class="url">{{ uiData.content.shareUrl }}</span>
			<!-- Social buttons -->
			<span class="social">
				<!-- Email -->
				<a href="mailto:?&subject=Join my chat on freech&body={{ uiData.content.shareUrl }}" target="_blank" class="button" style="color:#011627;background:#011627">EMail</a>
				<!-- Twitter -->
				<a href="https://twitter.com/intent/tweet?url={{ uiData.content.shareUrl }}" target="_blank" class="button" style="color:#1da1f2;background:#1da1f2">Twitter</a>
				<!-- Facebook -->
				<a href="https://www.facebook.com/sharer/sharer.php?u={{ uiData.content.shareUrl }}" target="_blank" class="button" style="color:#365899;background:#365899">Facebook</a>
			</span>
			<!-- Close -->
			<a href="javascript:void(0)" v-on:click="buttonToggleShare" class="button">Done</a>
		</div>
		
		<!-- New Chat Modal -->
		<div class="modal" v-if="uiData.modals.newChat">
			<span class="error" v-if="uiData.errors.createNewChat">Failed to create a chat.</span>
			<h1>New chat</h1>
			<p>Do you want to create a new chat?</p>
			<a href="javascript:void(0)" v-on:click="buttonNewChat" v-bind:class="{ 'loading': uiData.loading.creatingChat }" class="button">Create Chat</a>
		</div>
		
		<!-- Enter Name Modal -->
		<div class="modal" v-if="uiData.modals.newUser">
			<span class="error" v-if="uiData.errors.createNewUser">Failed to join the chat. Have you tried <a href="/chat">creating a new one</a>?</span>
			<span class="error" v-if="uiData.errors.createNewUserInput">You need to enter a name.</span>
			<h1>Your name</h1>
			<p>Please enter your name.</p>
			<input type="text" v-model="input.newUserName" v-on:keyup.enter="buttonCreateUser" placeholder="What's your name?">
			<a href="javascript:void(0)" v-on:click="buttonCreateUser" v-bind:class="{ 'loading': uiData.loading.creatingUser }" class="button">Join Chat</a>
		</div>
		
		<!-- Connection Lost Modal -->
		<div class="modal error" v-if="uiData.modals.disconnect">
			<!-- Lost connection -->
			<span v-if="freechTemp.expirationTimeLeft > 0">
				<h1>Connection lost</h1>
				<p>Do you want to reconnect?</p>
				<a href="javascript:void(0)" v-on:click="buttonReconnect" class="button">Reconnect</a>
			</span>
			<!-- Lost connection & chat is expired -->
			<span v-else>
				<h1>The chat expired</h1>
				<p>You can always create a new chat.</p>
				<a href="/chat" class="button">New Chat</a>
			</span>
		</div>
		
		<!-- Full Loading TODO: Make this nicer -->
		<div class="full-loading" v-if="uiData.loading.full">
			Loading ...
		</div>
		
		<!-- Scripts -->
		<script src="./js/libs.js"></script>
		<script src="./js/chat.js"></script>
	</body>
	
</html>
